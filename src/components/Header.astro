---
import { Icon } from "astro-icon/components";
import Socials from "./Socials.astro";
import { categories, links } from "@/data/menu";
---

<!-- HEADER CON AUTOHIDE -->
<section
  id="main-header"
  class="fixed w-full top-0 left-0 bg-gradient-to-r from-blue-600 to-blue-900 text-white shadow-md z-50 transition-transform duration-300"
>
  <header
    class="grid grid-cols-1 md:grid-cols-3 items-center justify-between max-w-6xl mx-auto px-3 gap-2 py-1 md:py-3"
  >
    <!-- IZQUIERDA -->
    <div
      class="flex flex-wrap justify-center md:justify-start items-center gap-1 text-sm"
    >
      <div class="flex items-center gap-2">
        <Icon name="location" size={18} class="text-main" />
        <p class="leading-tight text-xs md:text-sm">
          Calle Concepci√≥n Taveras, La Vega
        </p>
      </div>
      <div class="flex items-center gap-1 text-xs md:text-sm">
        <Icon name="phoneCall" size={18} />
        <strong>
          Ll√°manos: <span class="text-main">8091234567</span>
        </strong>
      </div>
    </div>

    <!-- CENTRO -->
    <div class="flex justify-center">
      <a href="/">
        <img
          src="/logo.png"
          alt="Logo de Inversiones Ventura"
          class="h-9 md:h-14 rounded-full object-contain"
        />
      </a>
    </div>

    <!-- DERECHA -->
    <div class="flex justify-center md:justify-end items-center gap-3">
      <Socials />
    </div>
  </header>

  <!-- NAVBAR -->
  <main class="max-w-6xl mx-auto px-3 pb-2 md:pt-2">
    <nav
      class="bg-gradient-to-r from-blue-900 to-blue-700 text-white shadow-md rounded-md"
    >
      <div class="w-full mx-auto flex justify-between items-center px-3 py-2">
        <!-- CATEGOR√çAS -->
        <div class="relative group w-48" id="dropdown-container">
          <button
            id="dropdown-toggle"
            class="flex items-center gap-2 pr-2 font-bold border-r border-blue-700/60 focus:outline-none cursor-pointer"
          >
            <span>Categor√≠as</span>
            <svg
              class="w-4 h-4 transition-transform"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>

          <ul
            id="dropdown-menu"
            class="absolute left-0 top-8 w-44 bg-blue-800 rounded-md shadow-lg border border-blue-700/60
                   hidden flex-col transition-all duration-200 origin-top z-50"
          >
            {
              categories.map((cat) => (
                <a href={cat.href}>
                  <li class="px-4 py-2 font-bold hover:bg-blue-700 border-b border-blue-700 last:border-none cursor-pointer">
                    {cat.name}
                  </li>
                </a>
              ))
            }
          </ul>
        </div>

        <!-- ENLACES DESKTOP -->
        <ul
          class="hidden lg:flex flex-1 gap-5 font-bold justify-center text-center w-full"
        >
          {
            links.map((link) => (
              <a href={link.href} class="hover:text-main transition-colors">
                <li>{link.name}</li>
              </a>
            ))
          }
        </ul>

        <!-- B√öSQUEDA -->
        <div
          class="hidden lg:flex items-center bg-blue-800 rounded-md overflow-hidden w-56"
        >
          <input
            type="text"
            placeholder="Buscar..."
            class="bg-transparent px-2 py-1 focus:outline-none text-sm placeholder-blue-200"
          />
          <button class="px-3 hover:bg-blue-700 transition-colors">
            <Icon name="search" size={18} />
          </button>
        </div>

        <!-- MEN√ö M√ìVIL -->
        <div class="lg:hidden flex relative" id="dropdown-links-container">
          <button
            id="dropdown-links-toggle"
            class="flex items-center focus:outline-none cursor-pointer"
          >
            <!-- SVG animado -->
            <svg
              id="burger-icon"
              xmlns="http://www.w3.org/2000/svg"
              width="28"
              height="28"
              viewBox="0 0 24 24"
              class="text-white"
            >
              <path
                id="burger-path"
                fill="none"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 5L12 5L19 5M5 12H19M5 19L12 19L19 19"
              >
                <animate
                  id="burger-anim"
                  attributeName="d"
                  dur="0.6s"
                  fill="freeze"
                  begin="indefinite"
                  values="M5 5L12 5L19 5M5 12H19M5 19L12 19L19 19;M5 5L12 12L19 5M12 12H12M5 19L12 12L19 19"
                ></animate>
              </path>
            </svg>
          </button>

          <ul
            id="dropdown-menu-links"
            class="absolute top-10 right-0 w-40 bg-blue-800 rounded-md shadow-lg border border-blue-700/60
                   flex-col hidden transition-all duration-200 origin-top-right z-50"
          >
            {
              links.map((link) => (
                <a href={link.href}>
                  <li class="px-4 py-2 font-bold hover:bg-blue-700 border-b border-blue-700 last:border-none">
                    {link.name}
                  </li>
                </a>
              ))
            }
          </ul>
        </div>
      </div>
    </nav>
  </main>
</section>

<!-- SCRIPT -->
<script is:inline>
  const toggle = document.getElementById("dropdown-toggle");
  const menu = document.getElementById("dropdown-menu");
  const container = document.getElementById("dropdown-container");

  const linksToggle = document.getElementById("dropdown-links-toggle");
  const linksMenu = document.getElementById("dropdown-menu-links");
  const linksContainer = document.getElementById("dropdown-links-container");

  const burgerAnim = document.getElementById("burger-anim");
  let isOpen = false;

  function openMenu(el) {
    el.classList.add("flex");
    el.classList.remove("hidden");
  }
  function closeMenu(el) {
    el.classList.remove("flex");
    el.classList.add("hidden");
  }

  toggle.addEventListener("click", (e) => {
    e.stopPropagation();
    menu.classList.contains("flex") ? closeMenu(menu) : openMenu(menu);
    closeMenu(linksMenu);
  });

  linksToggle.addEventListener("click", (e) => {
    e.stopPropagation();
    isOpen = !isOpen;

    if (isOpen) {
      openMenu(linksMenu);
      burgerAnim.setAttribute(
        "values",
        "M5 5L12 5L19 5M5 12H19M5 19L12 19L19 19;M5 5L12 12L19 5M12 12H12M5 19L12 12L19 19"
      );
    } else {
      closeMenu(linksMenu);
      burgerAnim.setAttribute(
        "values",
        "M5 5L12 12L19 5M12 12H12M5 19L12 12L19 19;M5 5L12 5L19 5M5 12H19M5 19L12 19L19 19"
      );
    }

    burgerAnim.beginElement();
  });

  document.addEventListener("click", (e) => {
    if (!container.contains(e.target)) closeMenu(menu);
    if (!linksContainer.contains(e.target) && isOpen) {
      closeMenu(linksMenu);
      isOpen = false;
      burgerAnim.setAttribute(
        "values",
        "M5 5L12 12L19 5M12 12H12M5 19L12 12L19 19;M5 5L12 5L19 5M5 12H19M5 19L12 19L19 19"
      );
      burgerAnim.beginElement();
    }
  });

  // üß≠ Auto-hide header on scroll
  const header = document.getElementById("main-header");
  let lastScroll = 0;

  window.addEventListener("scroll", () => {
    const currentScroll = window.scrollY;
    if (currentScroll > lastScroll && currentScroll > 200) {
      header.style.transform = "translateY(-100%)";
    } else {
      header.style.transform = "translateY(0)";
    }
    lastScroll = currentScroll;
  });
</script>
